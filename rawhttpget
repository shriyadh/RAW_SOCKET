#!/usr/bin/env python3
# TOKEN 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
# My password Benzene66


import ssl
import socket
import sys
from random import randint
from struct import *
from urllib.parse import urlparse
from TCP import TCP


class RawSocket():

    receiver_socket = None

    sender_socket = None

    remote_host = ""
    local_host  = ""
    remote_port = -9999
    local_port = -9999
    def __init__(self):
        self.sender_socket = socket.socket(socket.AF_INET, socket.SOCK_RAW, socket.IPPROTO_RAW)
        self.receiver_socket = socket.socket(socket.AF_INET, socket.SOCK_RAW, socket.IPPROTO_TCP)
        self.local_port = randint(1001, 65535)

        self.local_IPAddress = ip


    def connect(self, host, port):

        self.remote_host = host
        self.remote_port = 80
        self.tcp_seq = 0


def parse_cmd_line():
    try:
        url = sys.argv[1]
    except:
        sys.exit("Please provide proper URL")

    return url


def get_file_name(url):
    # check if proper path is given, if not set default
    if url.endswith('/'):
        file = "index.html"
    else:
        # split to get file name
        file = url.split('/')[-1]

    return file


def make_request(url):
    return "GET " + url + " HTTP/1.0\r\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\r\n" \
                          "Connection: close\r\n\r\n"


def start_download(url):
    # parse file name
    file = get_file_name(url)
    print(file)

    # get host and path
    eg = "https://david.choffnes.com/classes/cs5700f22/2MB.log"
    urlInformation = urlparse(url)
    print(urlInformation)

    host_name = urlInformation.netloc
    filePath = urlInformation.path
    print(filePath)

    # make request
    get_request = make_request(url)
    print(get_request)

    # add TCP header + IP header to create IP Datagram
    #sock = TCP()
    #sock.establish_handshake(host_name, 80)
    #sock.send_request(get_request)



    # open file and read
    # fOpen = open(file, 'wb+')

    # create socket
    # create_socket()


def main():
    # testing
    # parse the cmd line to get the url download link
    #url = parse_cmd_line()
   # print(url)


    #start_download(url)
    test = TCP()
    test.establish_handshake("http://david.choffnes.com/classes/cs5700f22/2MB.log ", 80)
    test.send_http_req()
    test.receive_http()
    #test.begin_teardown()





if __name__ == "__main__":
    main()